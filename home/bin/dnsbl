#!/bin/sh
#
# dnsbl-check-standalone.sh
#
# By Damon Tajeddini (dta)
# # 10.03.2009
#

MAIL_RCPT="postmaster@herrbischoff.com"

DNSBLlist=`grep -v ^# <<!
0spam.fusionzero.com
3y.spam.mrs.kithrup.com
access.redhawk.org
b.barracudacentral.org
bad.psky.me
badconf.rhsbl.sorbs.net
bb.barracudacentral.org
bl.blocklist.de
bl.mailspike.net
bl.spamcannibal.org
bl.spamcop.net
bl.spameatingmonkey.net
bl.starloop.com
blackholes.five-ten-sg.com
blackholes.uceb.org
blacklist.sci.kun.nl
blacklist.spambag.org
block.dnsbl.sorbs.net
bogons.cymru.com
cart00ney.surriel.com
cbl.abuseat.org
cidr.bl.mcafee.com
combined.njabl.org
db.wpbl.info
dev.null.dk
dialup.blacklist.jippg.org
dialups.visi.com
dnsbl-1.uceprotect.net
dnsbl-2.uceprotect.net
dnsbl-3.uceprotect.net
dnsbl.inps.de
dnsbl.jammconsulting.com
dnsbl.justspam.org
dnsbl.kempt.net
dnsbl.njabl.org
dnsbl.othello.ch
dnsbl.sorbs.net
dnsrbl.org
dul.dnsbl.sorbs.net
dyna.spamrats.com
fl.chickenboner.biz
forbidden.icm.edu.pl
http.dnsbl.sorbs.net
ips.backscatterer.org
ix.dnsbl.manitu.net
korea.services.net
l1.spews.dnsbl.sorbs.net
l2.spews.dnsbl.sorbs.net
mail-abuse.blacklist.jippg.org
misc.dnsbl.sorbs.net
no-more-funn.moensted.dk
noptr.spamrats.com
orvedb.aupads.org
pbl.spamhaus.org
psbl.surriel.com
rbl.megarbl.net
rbl.orbitrbl.com
rbl.schulte.org
rbl.triumf.ca
rblmap.tu-berlin.de
rfc-ignorant.org
rhsbl.rymsho.ru
rhsbl.sorbs.net
rsbl.aupads.org
safe.dnsbl.sorbs.net
sbl.spamhaus.org
smtp.dnsbl.sorbs.net
socks.dnsbl.sorbs.net
spam.dnsbl.sorbs.net
spam.olsentech.net
spam.spamrats.com
spam.wytnij.to
spamguard.leadmon.net
spamsources.fabel.dk
srnblack.surgate.net
truncate.gbudb.net
uribl.abuse.ro
virbl.dnsbl.bit.nl
web.dnsbl.sorbs.net
xbl.spamhaus.org
zen.spamhaus.org
zombie.dnsbl.sorbs.net
# dnsbl-2.uceprotect.net
# dnsbl-3.uceprotect.net
!`

# reverse IP address bytes
convertIP()
{
 set `IFS=".";echo $1`
 echo $4.$3.$2.$1
}

usage()
{
 echo "Usage: $0 [-H <host>|-p]"
 echo " -H IP address to check"
 echo " -p Print list of DNSBLs"
 exit 3
}

# Checks the IP with list of DNSBL servers
check()
{
 for i in $DNSBLlist
 do
 if dig $ip_arpa.$i +short | grep -q "^127.0.0."
 then
 echo "** Service Alert: $ip found on $i **"
 echo <<!
 *** DNSBL WARNING ***
 Service: $progname
 Host: `hostname`
 Date/Time: `date`
 Additional Info: DNSBL-Alarm: $ip is listed on $i
!
 fi
 done
 exit
} # check

case $1 in
 -H)
 if [ -z "$2" ]; then
 echo "ip address missing"
 exit
 fi
 ip=$2
 ip_arpa=`convertIP $ip`
 check;;

 -p)
 for i in $DNSBLlist
 do
 echo $i
 done
 exit;;

 --help)
 usage
 exit;;

 *)
 if [ -z "$1" ]; then
 usage
 fi
 echo "unknown command: $1"
 exit;;
esac
